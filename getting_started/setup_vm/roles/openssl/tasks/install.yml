- name: Include distribution vars
  include_vars:
    file: common.yml

- name: Gather package facts
  ansible.builtin.package_facts:
    manager: auto

- name: Package version
  shell: echo "{{ ansible_facts.packages["openssl"][0].version }}"
  register: openssl_version

- name: First version
  shell: echo "{{ openssl_version.stdout.split("ubuntu")[0] }}"
  register: openssl_version_first

- name: Second version
  shell: echo "{{ openssl_version.stdout.split("ubuntu")[1] }}"
  register: openssl_version_second

# TODO: Remove
- name: Debug
  ansible.builtin.debug:
    var: openssl_version_first.stdout

- name: Assert that OpenSSL version at least TODO
  ansible.builtin.assert:
    that:
      # (== 1.1.1 and ) or ()
      # - "'1.1.1' is version('{{ ubuntu_openssl_deb_version }}', '>=')"
      - "'{{ openssl_version_second.stdout }}' is version('{{ ubuntu_openssl_version }}', '>=')"
    success_msg: openssl version should be later than 1.1.1f-ubuntu2.18
# TODO:
# - Split "1.1.1f-1"
# - Split ubuntu"2.18"

# - name:
# - name: Facts for openssl must exist to go on
#   ansible.builtin.assert:
#     that: ansible_facts.packages[openssl] is defined
# - name: Install OpenSSL
#   apt:
#     name: "{{ openssl_ubuntu_deb_package }}"
#     state: present
#   become: true
