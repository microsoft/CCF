- name: Include vars for Clang 10
  include_vars: clang10.yml
  when: clang_version == "10"

- name: Include vars for Clang 12
  include_vars: clang12.yml
  when: clang_version == "12"

- name: Install debs
  apt:
    name: "{{ debs }}"
    update_cache: yes
  become: yes

# Note: Do not install docker CLI if moby-buildx is already installed
- name: Gather the package facts
  ansible.builtin.package_facts:
    manager: auto

- name: Add docker-ce repository key
  apt_key:
    url: "https://download.docker.com/linux/ubuntu/gpg"
    state: present
  become: yes
  when: "'moby-buildx' not in ansible_facts.packages"

- name: Add docker repository
  apt_repository:
    repo: "deb https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
    state: present
    update_cache: yes
  become: yes
  when: "'moby-buildx' not in ansible_facts.packages"

- name: Install docker debs
  apt:
    name: "{{ docker_debs }}"
    update_cache: yes
  become: yes
  when: "'moby-buildx' not in ansible_facts.packages"

- name: Remove doxygen debian package
  apt:
    name: doxygen
    state: absent
  become: yes

- name: Download doxygen
  get_url:
    url: "{{ doxygen_url }}"
    dest: "{{ workspace }}/{{ doxygen_bin }}"

- name: Expand doxygen
  unarchive:
    src: "{{ workspace }}/{{ doxygen_bin }}"
    dest: "{{ workspace }}"
    copy: no
    creates: "{{ workspace }}/doxygen-{{ doxygen_ver }}/Makefile"

- name: Install doxygen
  command: make install
  args:
    chdir: "{{ workspace }}/doxygen-{{ doxygen_ver }}"
  become: true
