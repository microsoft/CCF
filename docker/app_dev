# Application Continuous Integration image
# Contains a CCF release, compile toolchain and Azure CLI tooling

FROM ubuntu:20.04

ARG extra_vars

RUN echo "APT::Acquire::Retries \"5\";" | tee  /etc/apt/apt.conf.d/80-retries

WORKDIR /
COPY ./docker/sgx_deps_pin.sh /
RUN ./sgx_deps_pin.sh && rm ./sgx_deps_pin.sh

COPY getting_started/setup_vm/ /setup_vm/
RUN apt update \
    && apt install -y ansible software-properties-common bsdmainutils dnsutils \
    && cd setup_vm \
    && ansible-playbook app-dev.yml $extra_vars \
    && rm -rf /tmp/* \
    && apt remove -y ansible software-properties-common \
    && apt -y autoremove \
    && apt -y clean