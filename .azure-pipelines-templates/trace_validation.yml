steps:
  - script: |
      set -ex
      sudo apt update
      sudo apt install -y default-jre
      python3 ./tla/install_deps.py
    displayName: "Install TLA dependencies"

  - script: |
      set -ex
      cd tla/
      JSON=../build/replicate.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/election.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/multi_election.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/check_quorum.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/reconnect.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/reconnect_node.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/bad_network.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/fancy_election.1.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/fancy_election.2.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/suffix_collision.1.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/suffix_collision.2.ndjson ./tlc.sh Traceccfraft.tla 2>&1
      JSON=../build/suffix_collision.3.ndjson ./tlc.sh Traceccfraft.tla 2>&1
    displayName: "Run trace validation"
