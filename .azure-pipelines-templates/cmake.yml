parameters:
  cmake_args: ""

steps:
  - script: |
      set -ex
      tests/sgxinfo.sh
      cat /proc/cpuinfo | grep flags | uniq
      sudo groupadd -fg $(/usr/bin/stat -Lc '%g' /dev/sgx/provision) sgx_prv
      sudo usermod -a -G sgx_prv $(whoami)
    displayName: Platform Info
    condition: succeededOrFailed()

  - script: |
      set -ex
      mkdir build
      cd build
      cmake -L -GNinja .. ${{ parameters.cmake_args }}
    displayName: CMake
