jobs:
  - job: configure
    displayName: "Configure CI"
    variables:
      Codeql.SkipTaskAutoInjection: true
      skipComponentGovernanceDetection: true
    pool:
      vmImage: "ubuntu-20.04"
    steps:
      - script: echo "##vso[task.setvariable variable=varA]hello"
        condition: succeededOrFailed()
      - script: |
          echo "##vso[task.setvariable variable=varB]hello"
        condition: succeededOrFailed()
      - script: |
          set -ex
          echo "##vso[task.setvariable variable=varC]hello"
          echo "I've just set varC"
        condition: succeededOrFailed()

      - script: |
          echo "varA=$(varA)"
          echo "varB=$(varB)"
          echo "varC=$(varC)"
        displayName: Display VSO Vars
        condition: succeededOrFailed()
  
      - script: echo "##vso[task.setvariable variable=varD;isOutput=true]hello"
        name: setD
        condition: succeededOrFailed()
      - script: |
          echo "##vso[task.setvariable variable=varE;isOutput=true]hello"
        name: setE
        condition: succeededOrFailed()
      - script: |
          set -ex
          echo "##vso[task.setvariable variable=varF;isOutput=true]hello"
          echo "I've just set varF"
        name: setF
        condition: succeededOrFailed()

      - script: |
          echo "varD=$(setD.varD)"
          echo "varE=$(setE.varE)"
          echo "varF=$(setF.varF)"
        displayName: Display VSO Vars
        condition: succeededOrFailed()

      - checkout: self
        clean: true

      - script: |
          echo "##vso[task.setvariable variable=docOnly;isOutput=true]true"

        displayName: "Check for runtime changes"
        name: setVarStep
