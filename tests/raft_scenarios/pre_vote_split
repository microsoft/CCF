pre_vote_enabled,false
start_node,0
emit_signature,2
swap_nodes,2,in,1
emit_signature,2

# Node 
pre_vote_enabled,true
swap_nodes,2,in,2
emit_signature,2

periodic_all,10
dispatch_all
periodic_all,10
dispatch_all
periodic_all,10
dispatch_all

assert_commit_idx,0,6
assert_config,0,5,0,1,2
assert_detail,0,leadership_state,Leader
assert_commit_idx,1,6
assert_config,1,5,0,1,2
assert_detail,1,leadership_state,Follower
assert_commit_idx,2,6
assert_config,2,5,0,1,2
assert_detail,2,leadership_state,Follower


# Node 2 (Pre-Vote enabled) can be elected
disconnect_node,0
periodic_one,2,100
assert_detail,2,leadership_state,PreVoteCandidate
assert_detail,2,current_view,2

dispatch_single,2,1
dispatch_single,1,2

assert_detail,2,leadership_state,Candidate
assert_detail,2,current_view,3

dispatch_single,2,1
dispatch_single,1,2

assert_detail,2,leadership_state,Leader

loop_until_sync

# Node 1 (Pre-Vote disabled) can be elected

disconnect_node,0
periodic_one,1,100
assert_detail,1,leadership_state,Candidate
assert_detail,1,current_view,4

dispatch_single,1,2
dispatch_single,2,1

assert_detail,1,leadership_state,Leader
assert_detail,1,current_view,4