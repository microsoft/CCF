nodes,0,1
connect,0,1

periodic_one,0,110
dispatch_all

assert_is_primary,0

# Reconfiguration: add two nodes
create_new_node,2
connect,0,2
connect,1,2

create_new_node,3
connect,0,3
connect,1,3
connect,2,3

create_new_node,4
connect,0,4
connect,1,4
connect,2,4
connect,3,4

dispatch_all

state_all

replicate_new_configuration,1,0,1,2,3,4 # New configuration: [0,1,2,3,4] in term 1 (quorum=3)
periodic_all,10

dispatch_one,0

state_all

# One new node calls for an election (e.g. because primary 1 is dead)
periodic_one,2,100
assert_is_candidate,2

state_all

dispatch_one,2

dispatch_one,3 # 3 sends vote response to 2
assert_is_candidate,2

dispatch_one,4 # 4 sends vote response to 2: 2 becomes primary
state_all
assert_is_primary,2