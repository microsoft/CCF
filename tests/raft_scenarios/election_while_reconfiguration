<<<<<<< HEAD
# This scenario checks that an election completes successfully and with the right 
# quorums when a reconfiguration is in flight
nodes,0,1,2
=======
nodes,0,1
>>>>>>> 14ea8245d... Simpler test
connect,0,1

periodic_one,0,110
dispatch_all

assert_is_primary,0
assert_is_backup,1

<<<<<<< HEAD
periodic_all,10
dispatch_all

state_all
=======
# Reconfiguration: add two nodes
create_new_node,2
connect,0,2
connect,1,2
>>>>>>> 14ea8245d... Simpler test

create_new_node,3
connect,0,3
connect,1,3
connect,2,3

create_new_node,4
connect,0,4
connect,1,4
connect,2,4
connect,3,4

<<<<<<< HEAD
create_new_node,5
connect,0,5
connect,1,5
connect,2,5
connect,3,5
connect,4,5

replicate_new_configuration,1,1,2,3,4,5 # New configuration: [1,2,3,4,5] in term 1 (quorum=3)
=======
dispatch_all

state_all

replicate_new_configuration,1,0,1,2,3,4 # New configuration: [0,1,2,3,4] in term 1 (quorum=3)
>>>>>>> 14ea8245d... Simpler test
periodic_all,10
dispatch_one,0

<<<<<<< HEAD
state_all # All nodes have seen the reconfiguration entry
=======
dispatch_one,0

state_all
>>>>>>> 14ea8245d... Simpler test

# One new node calls for an election (e.g. because primary 1 is dead)
periodic_one,2,100
assert_is_candidate,2

<<<<<<< HEAD
dispatch_one,3
dispatch_one,1
dispatch_one,2

state_all
assert_is_primary,3
=======
state_all

dispatch_one,2

dispatch_one,3 # 3 sends vote response to 2
assert_is_candidate,2

dispatch_one,4 # 4 sends vote response to 2: 2 becomes primary
state_all
assert_is_primary,2
>>>>>>> 14ea8245d... Simpler test
