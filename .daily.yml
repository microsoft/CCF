pr:
  branches:
    include:
      - main
      - "release/*"
  paths:
    include:
      - .daily.yml
      - .azure-pipelines-templates/*
      - .daily_canary

trigger: none

resources:
  containers:
    - container: virtual
      image: ccfmsrc.azurecr.io/ccf/ci:16-08-2023-1-virtual-clang15
      options: --publish-all --cap-add NET_ADMIN --cap-add NET_RAW --cap-add SYS_PTRACE

    - container: snp
      image: ccfmsrc.azurecr.io/ccf/ci:16-08-2023-1-snp-clang15
      options: --publish-all --cap-add NET_ADMIN --cap-add NET_RAW --cap-add SYS_PTRACE -v /lib/modules:/lib/modules:ro

    - container: sgx
      image: ccfmsrc.azurecr.io/ccf/ci:16-08-2023-1-sgx
      options: --publish-all --cap-add NET_ADMIN --cap-add NET_RAW --device /dev/sgx_enclave:/dev/sgx_enclave --device /dev/sgx_provision:/dev/sgx_provision -v /dev/sgx:/dev/sgx

jobs:
  - template: .azure-pipelines-templates/configure.yml

  - template: .azure-pipelines-templates/daily-matrix.yml
